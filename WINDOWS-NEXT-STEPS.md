# FGBrowser - Windows Development Continuation Guide

## Current Status (macOS Work Complete)

### ‚úÖ What's Been Done
1. **Removed all macOS builds** - Windows-only release workflow
2. **Simplified release process** to 2 commands:
   - `make bump-patch` (or `bump-minor`/`bump-major`)
   - `make release`
3. **Configured Tauri auto-updater** with signing keys in GitHub Secrets
4. **Added pre-commit hooks** for Rust, Svelte, and plist validation
5. **Setup Rust caching** in GitHub Actions for faster builds (~5-7 min now)

### üîÑ What's Currently Running
- Release v0.1.11 is building: https://github.com/nodtOx/FGBrowser/actions/runs/18624973471
- Should complete in ~5-7 minutes
- Will create: `FGBrowser_0.1.11_x64-setup.exe`

---

## ‚ö†Ô∏è Critical: Auto-Updater Status

### The Issue
The auto-updater requires `latest.json` to be uploaded to GitHub releases. This file should be automatically generated by GitHub Actions when:
1. `TAURI_SIGNING_PRIVATE_KEY` secret is set ‚úÖ
2. `TAURI_SIGNING_PRIVATE_KEY_PASSWORD` secret is set ‚úÖ
3. Build completes successfully

### To Verify (AFTER v0.1.11 build completes):

**Check if `latest.json` was created:**
```bash
gh release view v0.1.11 --repo nodtOx/FGBrowser --json assets --jq '.assets[].name'
```

**Expected output:**
```
FGBrowser_0.1.11_x64-setup.exe
FGBrowser_0.1.11_x64-setup.exe.sig
latest.json
```

**If `latest.json` is missing**, check GitHub Actions logs:
```bash
gh run view 18624973471 --repo nodtOx/FGBrowser --log
```

Look for errors like:
- `Signature not found for the updater JSON`
- `Failed to upload latest.json`
- Issues with `TAURI_PRIVATE_KEY` or `TAURI_PRIVATE_KEY_PASSWORD`

---

## ü™ü Windows-Specific Tasks

### 1. Setup Development Environment

**Install Required Tools:**
```powershell
# Install Rust
winget install Rustlang.Rust.MSVC

# Install Node.js
winget install OpenJS.NodeJS.LTS

# Install GitHub CLI (optional but recommended)
winget install GitHub.cli

# Install Visual Studio Build Tools (required for Rust)
# Download from: https://visualstudio.microsoft.com/downloads/
# Select "Desktop development with C++"
```

**Clone and Setup:**
```powershell
git clone https://github.com/nodtOx/FGBrowser.git
cd FGBrowser
npm install
```

### 2. Test Auto-Updater Locally

**Build a local version:**
```powershell
npm run tauri build
```

**Install the built version:**
- Go to `src-tauri\target\release\bundle\nsis\`
- Run `FGBrowser_*_x64-setup.exe`
- App installs to `C:\Program Files\FGBrowser\`

**Test update check:**
1. Open the app
2. App should check for updates on startup (configured in `src-tauri/tauri.conf.json`)
3. Look for update notification UI (if implemented)

**Check updater config:**
```json
// src-tauri/tauri.conf.json
"plugins": {
  "updater": {
    "active": true,
    "endpoints": [
      "https://github.com/nodtOx/FGBrowser/releases/latest/download/latest.json"
    ],
    "dialog": false,  // Change to true to show built-in dialog
    "pubkey": "dW50cnVzdGVkIGNvbW1lbnQ6IG1pbmlzaWduIHB1YmxpYyBrZXk6IDU2QzdBNjI5NDI5M0FCMTgKUldRWXE1TkNLYWJIVnNTVk1MTmFnZytObXMxd3hwbzRGVUVqMVE5L0U3WU9JVE51VFFOdkJkL28K"
  }
}
```

### 3. Implement Update UI (If Not Done)

**Current status:** The updater is configured but UI notification might not be implemented.

**Check if update handling exists:**
```powershell
# Search for updater code
Select-String -Path "src/lib/*" -Pattern "updater" -Recurse
Select-String -Path "src-tauri/src/*" -Pattern "updater" -Recurse
```

**If missing, add update notification:**

Create `src/lib/stores/appUpdater.ts` (might already exist):
```typescript
import { writable } from 'svelte/store';
import { check } from '@tauri-apps/plugin-updater';
import { relaunch } from '@tauri-apps/plugin-process';

export const updateAvailable = writable<boolean>(false);
export const updateManifest = writable<any>(null);

export async function checkForUpdates() {
  try {
    const update = await check();
    
    if (update) {
      updateAvailable.set(true);
      updateManifest.set(update);
      return update;
    }
  } catch (error) {
    console.error('Failed to check for updates:', error);
  }
  return null;
}

export async function installUpdate(update: any) {
  try {
    await update.downloadAndInstall();
    await relaunch();
  } catch (error) {
    console.error('Failed to install update:', error);
  }
}
```

Add update check in `src/routes/+page.svelte`:
```typescript
import { onMount } from 'svelte';
import { checkForUpdates } from '$lib/stores/appUpdater';

onMount(() => {
  // Check for updates on app start
  checkForUpdates();
});
```

### 4. Test Release Workflow on Windows

**Make a test release:**
```powershell
# Bump version
./scripts/bump-version.sh patch

# Create release (requires git bash or WSL)
./scripts/release.sh

# OR manually:
git tag v0.1.12
git push origin v0.1.12
```

**Monitor build:**
```powershell
gh run list --repo nodtOx/FGBrowser --workflow "Release" --limit 1
gh run watch <RUN_ID> --repo nodtOx/FGBrowser
```

---

## üêõ Troubleshooting

### Issue: `latest.json` Not Generated

**Cause**: GitHub Actions environment variables might not be set correctly.

**Fix**:
1. Go to: https://github.com/nodtOx/FGBrowser/settings/secrets/actions
2. Verify these secrets exist:
   - `TAURI_SIGNING_PRIVATE_KEY`
   - `TAURI_SIGNING_PRIVATE_KEY_PASSWORD`

3. Check GitHub Actions workflow uses correct env var names:
```yaml
# .github/workflows/release.yml
env:
  GITHUB_TOKEN: ${{ secrets.GITHUB_TOKEN }}
  TAURI_PRIVATE_KEY: ${{ secrets.TAURI_SIGNING_PRIVATE_KEY }}
  TAURI_PRIVATE_KEY_PASSWORD: ${{ secrets.TAURI_SIGNING_PRIVATE_KEY_PASSWORD }}
```

**Note**: Tauri expects `TAURI_PRIVATE_KEY` but the secret is named `TAURI_SIGNING_PRIVATE_KEY`.

### Issue: Auto-Updater Not Working in App

**Debugging:**
```typescript
// Add logging in your updater code
const update = await check();
console.log('Update check result:', update);
```

**Common causes:**
- App version in `tauri.conf.json` is same or newer than release
- `latest.json` doesn't exist in release
- Public key mismatch
- Network/CORS issues (less likely with GitHub)

### Issue: Build Fails on GitHub Actions

**Check logs:**
```powershell
gh run view <RUN_ID> --repo nodtOx/FGBrowser --log
```

**Common issues:**
- Rust compilation errors
- Frontend build errors
- Tauri signing errors

---

## üìù Next Steps Checklist

1. ‚úÖ Wait for v0.1.11 build to complete
2. ‚¨ú Verify `latest.json` exists in release
3. ‚¨ú Download and install `FGBrowser_0.1.11_x64-setup.exe`
4. ‚¨ú Test app launches correctly
5. ‚¨ú Test auto-updater (after releasing v0.1.12)
6. ‚¨ú Implement update notification UI if missing
7. ‚¨ú Document final release workflow

---

## üîë GitHub Secrets Reference

**Location**: https://github.com/nodtOx/FGBrowser/settings/secrets/actions

**Required Secrets:**
- `TAURI_SIGNING_PRIVATE_KEY`: The base64-encoded private key from Tauri signer
- `TAURI_SIGNING_PRIVATE_KEY_PASSWORD`: The password used when generating the key

**Public Key** (in `src-tauri/tauri.conf.json`):
```
dW50cnVzdGVkIGNvbW1lbnQ6IG1pbmlzaWduIHB1YmxpYyBrZXk6IDU2QzdBNjI5NDI5M0FCMTgKUldRWXE1TkNLYWJIVnNTVk1MTmFnZytObXMxd3hwbzRGVUVqMVE5L0U3WU9JVE51VFFOdkJkL28K
```

---

## üìö Useful Commands Reference

**Development:**
```powershell
npm run tauri dev          # Run dev server
npm run tauri build        # Build release locally
npm run check              # Type-check Svelte
cd src-tauri && cargo clippy  # Lint Rust
```

**Version Management:**
```bash
./scripts/bump-version.sh patch   # 0.1.11 ‚Üí 0.1.12
./scripts/bump-version.sh minor   # 0.1.11 ‚Üí 0.2.0
./scripts/bump-version.sh major   # 0.1.11 ‚Üí 1.0.0
```

**Release:**
```bash
./scripts/release.sh       # Full automated release
```

**GitHub CLI:**
```powershell
gh release list --repo nodtOx/FGBrowser
gh release view v0.1.11 --repo nodtOx/FGBrowser
gh run list --repo nodtOx/FGBrowser --workflow "Release"
gh run watch <ID> --repo nodtOx/FGBrowser
```

---

## üéØ Testing Auto-Updater End-to-End

**Scenario**: Test that users get notified and can update

1. **Install old version** (e.g., v0.1.11)
2. **Release new version** (e.g., v0.1.12) with changes
3. **Open old version** - should check for updates
4. **Click "Update"** - should download and install v0.1.12
5. **App restarts** with new version

**Current Status**:
- ‚úÖ Updater plugin configured
- ‚úÖ Signing keys in GitHub Secrets
- ‚ö†Ô∏è Update notification UI might need implementation
- ‚ùì `latest.json` generation needs verification

---

## üìû Questions to Answer

1. **Does `latest.json` get generated in v0.1.11 release?**
   - Check: `gh release view v0.1.11 --repo nodtOx/FGBrowser --json assets --jq '.assets[].name'`

2. **Is update notification UI implemented?**
   - Check: `src/lib/components/UpdateNotification.svelte` exists?
   - Check: `src/lib/stores/appUpdater.ts` exists?

3. **Does the app check for updates on startup?**
   - Look in `src/routes/+page.svelte` for `checkForUpdates()` call

4. **Can we test the updater locally?**
   - Need to mock the endpoint or use real releases

---

## üöÄ When Everything Works

**Your workflow will be**:
```powershell
# 1. Make changes
git add .
git commit -m "feat: new feature"

# 2. Bump version
./scripts/bump-version.sh patch

# 3. Release
./scripts/release.sh

# Wait ~5-7 minutes

# 4. Done! Users get automatic update notification
```

**What happens automatically:**
- ‚úÖ Version bumped in all files
- ‚úÖ Changes committed
- ‚úÖ Git tag created and pushed
- ‚úÖ GitHub Actions builds Windows installer
- ‚úÖ `latest.json` generated and uploaded
- ‚úÖ Release published
- ‚úÖ Users get update notification next time they open app

---

## üìã Files Modified in This Session

**Deleted:**
- `homebrew/` (entire directory)
- `scripts/update-homebrew-after-release.sh`
- `src-tauri/entitlements.plist`

**Modified:**
- `.github/workflows/release.yml` - Windows-only build
- `README.md` - Windows-only instructions
- `scripts/release.sh` - Removed Homebrew SHA256 update
- `scripts/bump-version.sh` - Removed Homebrew file updates
- `src-tauri/tauri.conf.json` - Removed macOS targets
- `Makefile` - Removed macOS-specific targets

**Created:**
- `WINDOWS-NEXT-STEPS.md` - This file!

---

**Good luck! The hard part (macOS signing hell) is behind us. Windows is much simpler. üéâ**

